<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Para Mar — Galería & Mensaje</title>
<meta name="description" content="Felices 22!. Te dejo unos recuerdos y al final un mensaje para vos." />
<meta name="theme-color" content="#3b0d80" />
<style>
  :root{
    /* Paleta violeta + atardecer */
    --bg:#ded2ff;               /* violeta muy oscuro */
    --bg-2:#b99bff;             /* capa extra */
    --fg:#f7f7fb;
    --muted:#c7c3d9;
    --violet:#7b31ff;
    --violet-2:#b07cff;
    --sun-1:#ff9a5a;            /* naranja suave */
    --sun-2:#ff6fa9;            /* rosado */
    --sky-1:#67d5ff;            /* celeste */
    --card:#463964;             /* panel */
    --glass:#ffffff12;
    --radius:16px;
    --shadow:0 10px 30px rgba(12, 59, 90, 0.4);
    --ring: 0 0 0 2px #3a1f5a22 inset;
  }
  *{box-sizing:border-box}
  html,body{height:100%}

    /* Registramos variables animables (porcentaje) */
  @property --gx { syntax: '<percentage>'; inherits: false; initial-value: 10%; }
  @property --gy { syntax: '<percentage>'; inherits: false; initial-value: -10%; }
  @property --hx { syntax: '<percentage>'; inherits: false; initial-value: 100%; }
  @property --hy { syntax: '<percentage>'; inherits: false; initial-value: 0%; }

  /* Fondo con gradientes que ahora “respiran” */
  body{
    /* valores iniciales */
    --gx: 10%;  /* x de la mancha 1 */
    --gy: -10%; /* y de la mancha 1 */
    --hx: 100%; /* x de la mancha 2 */
    --hy: 0%;   /* y de la mancha 2 */

    margin:0; color:var(--fg); font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, sans-serif;
    background:
      radial-gradient(1000px 600px at var(--gx) var(--gy), #4c3579 0, transparent 50%),
      radial-gradient(900px 500px at var(--hx) var(--hy), #5e358a 0, transparent 50%),
      linear-gradient(180deg, var(--bg) 0, var(--bg-2) 100%);
    animation: bgDrift 5s ease-in-out infinite alternate;
    /* opcional para un “parallax” suave */
    background-attachment: fixed;
  }

  @keyframes bgDrift{
    0%   { --gx: 8%;  --gy: -12%; --hx: 100%; --hy: 95%; }
    50%  { --gx: 16%; --gy: 42%;  --hx: 88%;  --hy: 44%; }
    100% { --gx: 25%; --gy: 77%;   --hx: 57%;  --hy: 2%; }
  }

  /* Respeto de accesibilidad */
  @media (prefers-reduced-motion: reduce){
    body{ animation: none; }
  }
  header{
    position:sticky; top:0; z-index:20; backdrop-filter:saturate(1.1) blur(8px);
    background:linear-gradient(180deg, #0b0717ee 0, #0b0717c8 60%, transparent);
    padding:14px 12px 10px; border-bottom:1px solid #ffffff18;
  }
  .hwrap{max-width:1100px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; gap:12px}
  .brand{display:flex; align-items:center; gap:12px}
  .logo{width:36px; height:36px; border-radius:12px; background:
    conic-gradient(from 210deg, var(--violet), var(--sun-2), var(--sun-1), var(--sky-1), var(--violet));
    box-shadow: var(--ring);}
  h1{margin:0; font-size:1.05rem; font-weight:800; letter-spacing:.2px;}
  .grad{
    background: linear-gradient(90deg, var(--violet), var(--sun-2), var(--sky-1));
    -webkit-background-clip:text; background-clip:text; color:transparent;
  }
  .hint{color:var(--muted); font-size:.9rem}

  main{max-width:1100px; margin:18px auto 120px; padding:0 12px}

  /* Masonry (columns) */
  .masonry{ column-width: 320px; column-gap: 14px; }
  @media (max-width:720px){ .masonry{ column-width: 220px; column-gap: 10px; } }
  .tile{ break-inside: avoid; display:block; margin:0 0 14px; border-radius: var(--radius); overflow:hidden; background:var(--card);
         border:1px solid #ffffff1a; box-shadow: var(--shadow); position:relative; cursor:pointer; }
  .tile .ph{ width:100%; height:100%; display:block; background:linear-gradient(135deg,#261344,#120a24); aspect-ratio:3/4; }
  .tile img, .tile video{ width:100%; height:auto; display:block; }
  .badge{
    position:absolute; top:8px; left:8px; padding:6px 10px; border-radius:999px; font-size:.75rem; font-weight:700;
    color:white; background:linear-gradient(90deg, #00000080, #00000020);
    border:1px solid #ffffff33; backdrop-filter: blur(4px);
  }
  .badge .dot{ display:inline-block; width:8px; height:8px; border-radius:999px; margin-right:6px; background:var(--violet-2); }
  .badge.video .dot{ background:var(--sun-1); }

  /* Lightbox */
  .overlay{ position:fixed; inset:0; display:none; place-items:center; z-index:50; }
  .overlay.active{ display:grid; }
  .backdrop{ position:absolute; inset:0; background:linear-gradient(180deg,#2b203d 0,#33265aee 40%, #3e3264ee 100%); }
  .dialog{ position:relative; width:min(92vw, 960px); max-height:86vh; border-radius:20px; overflow:hidden; background:linear-gradient(180deg, #1a0f33, #120a24);
           border:1px solid #ffffff25; box-shadow: 0 30px 80px #000000aa; display:flex; flex-direction:column; }
  .viewer{ position:relative; display:grid; place-items:center; padding:8px; }
  .viewer img, .viewer video{ max-width:100%; max-height:64vh; width:auto; height:auto; border-radius:12px; background:#0b0717; }
  .desc{ padding:12px 14px 14px; color:#e9e7f5; border-top:1px solid #ffffff16; }
  .desc .meta{ color:var(--muted); font-size:.85rem; }
  .close, .navbtn{
    position:absolute;
    background: linear-gradient(135deg, #46467ccc, #4c4c7ec0);
    color:white;
    border:1px solid rgba(255,255,255,.65);
    border-radius:14px;
    width:56px; height:56px;
    display:grid; place-items:center;
    cursor:pointer; backdrop-filter: blur(4px);
    font-weight:900; font-size:15px; line-height:1;
    box-shadow: 0 10px 28px rgba(181, 102, 255, 0.295);
    z-index:5;  /* más arriba que el video/imagen */
    opacity:.96;
  }
  .close{ top:5px; right:5px; }
  .navbtn{ top:50%; transform: translateY(-50%); }
  .prev{ left:5px; }
  .next{ right:5px; }
  .close:hover, .navbtn:hover{ filter: brightness(1.1); }

  /* Lock section */
  .lock{
    margin:26px 0 0; padding:16px; border-radius:var(--radius); background:linear-gradient(180deg, #1a0f33, #120a24);
    border:1px dashed #ffffff40; box-shadow:var(--shadow);
  }
  .title2{ margin:6px 0 8px; font-size:1.1rem; font-weight:800; }
  .note{ color:var(--muted); }
  .digits{ display:flex; gap:10px; margin:12px 0 14px; justify-content:center; }
  .digits input{ width:58px; height:68px; text-align:center; font-size:2rem; border-radius:12px; border:1px solid #ffffff33; background:#37285c; color:var(--fg); outline:none; box-shadow: inset 0 2px 0 #0000005a; }
  .digits input:focus{ border-color:#8ab7ff }
  .actions{ display:flex; gap:10px; justify-content:center; align-items:center; }
  button{ padding:12px 14px; border:0; border-radius:12px; font-weight:800; cursor:pointer; color:white; background:linear-gradient(90deg, var(--violet), var(--sun-2)); box-shadow: var(--ring); }
  .subtle{ background: #ffffff18; }
  .msg{ min-height:1.2em; text-align:center; font-weight:700; }
  .ok{ color:#3cffb3 } .err{ color:#ff6b88 }

  /* Final video */
  #final{ display:none; margin-top:16px; }
  .card{ background:linear-gradient(180deg,#1a0f33,#120a24); border:1px solid #ffffff1f; border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden; }
  .card .head{ padding:12px 14px; border-bottom:1px solid #ffffff16; }
  .card .body{ padding:12px 14px 16px; }
  video.final{ width:100%; border-radius:12px; background:#0b0717 }

  /* Confetti */
  .confetti{ position:fixed; top:-8vh; width:10px; height:14px; transform:rotate(15deg); opacity:.95; z-index:9999; pointer-events:none }
  @keyframes fall { to { transform: translateY(110vh) rotate(360deg);} }

  footer{ position:fixed; inset-inline:0; bottom:10px; text-align:center; color:#bdb5d8; font-size:.85rem; opacity:.65 }

  @media (prefers-reduced-motion: reduce){
    .confetti{ display:none }
  }
  /* ===== Quad 2x2 (4 ítems visibles) ===== */
  .gallery.quad{ display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:10px; }
  .gallery.quad .tile{ margin:0; height: var(--tile-h, 40svh); }
  .gallery.quad .tile .ph,
  .gallery.quad .tile img,
  .gallery.quad .tile video{ width:100%; height:100%; object-fit:cover; aspect-ratio:auto; }
  @media (max-width:720px){ .gallery.quad{ gap:8px } }
  /* --- Animations & Sparkles Pack --- */
  /* Ocultar badge de tipo si existiera */
  .badge{ display:none !important; }

  /* Shine suave sobre cada tarjeta */
  .tile{ position:relative; }
  .tile::after{
    content:""; position:absolute; inset:0; pointer-events:none;
    background: linear-gradient(120deg, transparent 40%, rgba(255,255,255,.18) 50%, transparent 60%);
    transform: translateX(-120%);
    transition: transform .9s ease;
  }
  .tile:hover::after{ transform: translateX(120%); }

  /* Descripción fija abajo de cada tile */
  .cap{
    position:absolute; left:0; right:0; bottom:0;
    padding:8px 10px; color:#fff; font-size:.9rem;
    background: linear-gradient(180deg, #0000, #0008 40%, #000B);
    border-top:1px solid #ffffff26; backdrop-filter: blur(2px);
  }
  .cap .meta{ font-size:.78rem; opacity:.85; margin-bottom:2px; }

  /* Botones del visor (más visibles y por encima del contenido) */
  .overlay .close, .overlay .navbtn{
    width:44px; height:44px; font-size:15px; line-height:1; opacity:.96;
    background: linear-gradient(135deg, #47475ad2, #40405acb);
    color:white; border:2px solid rgba(255,255,255,.7);
    border-radius:14px; box-shadow:0 10px 28px rgba(0,0,0,.6); z-index:5;
  }
  .overlay .close{ top:5px; right:5px; }
  .overlay .navbtn{ top:50%; transform:translateY(-50%); }
  .overlay .prev{ left:5px; }
  .overlay .next{ right:5px; }
  .overlay .close:hover, .overlay .navbtn:hover{ filter:brightness(1.1) }

  /* Entrada con efecto pop en el visor */
  @keyframes popIn{ 0%{ transform: scale(.92) rotate(-1deg); opacity:0 } 60%{ transform: scale(1.03) rotate(.3deg); opacity:1 } 100%{ transform: scale(1) rotate(0) } }

  /* Emojis tiernos al abrir */
  .emoji-pop{
    position:fixed; left:0; top:0; translate:-50% -50%;
    font-size:22px; z-index:60; pointer-events:none;
    filter: drop-shadow(0 4px 10px rgba(0,0,0,.45));
    animation: floatUp 900ms ease-out forwards;
  }
  @keyframes floatUp{ to{ transform: translate(var(--dx), var(--dy)) rotate(var(--rot)); opacity:0 } }
</style>
</head>
<body>
  <header>
    <div class="hwrap">
      <div class="brand">
        <h1><span class="grad">Felices 22!</span> • Marchu 💜</h1>
      </div>
      <div class="hint">Te dejo unos bonitos recuerdos y al final un mensaje para vos</div>
    </div>
  </header>

  <main>
    <!-- Galería -->
    <section id="gallery" class="gallery quad" aria-label="Galería de fotos y videos"></section>

    <!-- Candado al fondo -->
    <section class="lock" id="lock">
      <div class="title2">Pone el código y mirá el video</div>
      <div class="digits" role="group" aria-label="Código de 4 dígitos">
        <input inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="Dígito 1" />
        <input inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="Dígito 2" />
        <input inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="Dígito 3" />
        <input inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="Dígito 4" />
      </div>
      <div class="actions">
        <button id="check">Abrir video</button>
        <button class="subtle" id="reset">Limpiar</button>
      </div>
      <p class="note">Pista: mirá tu brazo izquierdo...</p>
      <p id="msg" class="msg"></p>
    </section>

    <!-- Final: Video desbloqueado -->
    <section id="final" class="card" aria-hidden="true">
      <div class="head">
        <strong>Para vos Mar</strong> • <span class="grad">Feliz vida para ti</span> 🎂
      </div>
      <div class="body">
        <video id="finalVid" class="final" controls playsinline preload="metadata">
          <source src="media/final.mp4" type="video/mp4" />
          Oh no...
        </video>
        <p>Gracias por todos estos momentos. Te amo. Juani</p>
      </div>
    </section>
  </main>

  <footer>Hecho con mucho amorcito ✨</footer>

  <!-- Lightbox / visor -->
  <div id="lightbox" class="overlay" role="dialog" aria-modal="true" aria-label="Visor de imagen o video">
    <div class="backdrop"></div>
    <div class="dialog">
      <button class="close" id="btnClose" aria-label="Cerrar">✕</button>
      <button class="navbtn prev" id="btnPrev" aria-label="Anterior">❮</button>
      <button class="navbtn next" id="btnNext" aria-label="Siguiente">❯</button>
      <div class="viewer" id="viewer"></div>
      <div class="desc" id="lbDesc">
        <div class="meta" id="lbMeta"></div>
        <div id="lbText"></div>
      </div>
    </div>
  </div>

<script>
  // ========= CONFIG =========
  const CODE = '1111'; // Código para el video final

  // Ajusta la altura para que entren 2 filas exactas (2x2)
  (function(){
    const headerEl = document.querySelector('header');
    function setTileH(){
      const gap = 18; // px de margen aproximado entre filas
      const h = Math.max(120, Math.floor((window.innerHeight - headerEl.offsetHeight - gap*2) / 2));
      document.documentElement.style.setProperty('--tile-h', h + 'px');
    }
    window.addEventListener('load', setTileH, {once:true});
    window.addEventListener('resize', setTileH);
  })();

  // Lista de ítems de la galería (mezcla de imágenes y videos)
  // Reemplazá src/desc con tus archivos reales. Podés tener 40, 60, 100… los que quieras.
  // type: 'img' | 'video'
  const ITEMS = [
    { type:'img',   src:'media/001.jpg', desc:'Nuestra primera Tutsy' },
    { type:'img',   src:'media/002.jpg', desc:'Deleitandome con tus primeras comidas' },
    { type:'img',   src:'media/003.jpg', desc:'Se nos rompió el auto' },
    { type:'img',   src:'media/004.jpg', desc:'Deleitandome con tu hermosura' },
    { type:'video', src:'media/004.mp4', desc:'Cuando te cortaste el pelo :|' },
    { type:'img',   src:'media/005.jpg', desc:'Haciendo match bebe' },
    { type:'img',   src:'media/006.jpg', desc:'Acá en un fiestón' },
    { type:'video', src:'media/007.mp4', desc:'Bailando nuestro track <3' },
    { type:'img',   src:'media/007.jpg', desc:'Hubiera querdio hacer lo mismo este año' },
    { type:'img',   src:'media/008.jpg', desc:'Cuando me volví a enamorar de vos' },
    { type:'img',   src:'media/009.jpg', desc:'Con la Cafuuu' },
    { type:'img',   src:'media/010.jpg', desc:'Acompañandome a tocar' },
    { type:'video', src:'media/010.mp4', desc:'Preparando de tus ricas pipsas' },
    { type:'img',   src:'media/011.jpg', desc:'Cuando fuimos a las cabañas en el Valle' },
    { type:'img',   src:'media/012.jpg', desc:'Tirando unas poses en la cabañita' },
    { type:'img',   src:'media/013.jpg', desc:'Siendo completamente felices' },
    { type:'img',   src:'media/014.jpg', desc:'Fotito en el miradorr' },
    { type:'video', src:'media/014.mp4', desc:'Haciendo yoguita en la plaza' },
    { type:'img',   src:'media/015.jpg', desc:'Admirando un paisaje increíble, y Los Reyunos de fondo' },
    { type:'img',   src:'media/016.jpg', desc:'Te abrazo en tu habitación' },
    { type:'img',   src:'media/017.jpg', desc:'Acá saliendo bien bellacos' },
    { type:'img',   src:'media/018.jpg', desc:'En el espejo antes de salir' },
    { type:'img',   src:'media/019.jpg', desc:'Desayunando en un hermoso lugar' },
    { type:'video', src:'media/019.mp4', desc:'Hermoso día en un hermoso lugar' },
    { type:'img',   src:'media/020.jpg', desc:'Por comer el helado más rico de mendo' },
    { type:'img',   src:'media/021.jpg', desc:'Cuando nos agarraron in fraganti' },
    { type:'img',   src:'media/022.jpg', desc:'Después de dormir al ado del río' },
    { type:'img',   src:'media/023.jpg', desc:'Fotito con el atardecer' },
    { type:'img',   src:'media/024.jpg', desc:'😍 😍 😍' },
    { type:'video', src:'media/024.mp4', desc:'Probando el mejor risotto de tu vida' },
    { type:'img',   src:'media/025.jpg', desc:'Viajecito a Las Leñas' },
    { type:'img',   src:'media/026.jpg', desc:'Siendo una con la montaña' },
    { type:'img',   src:'media/027.jpg', desc:'En la carpa regocijandonos de amor' },
    { type:'img',   src:'media/028.jpg', desc:'Que delicias' },
    { type:'img',   src:'media/029.jpg', desc:'Acá con el Doni' },
    { type:'video', src:'media/029.mp4', desc:'Salida a comer sushi' },
    { type:'img',   src:'media/030.jpg', desc:'En una terraza tomando unos drinks' },
    { type:'img',   src:'media/031.jpg', desc:'De gala bien pitucos' },
    { type:'img',   src:'media/032.jpg', desc:'Antes de tocar en Alvear' },
    { type:'img',   src:'media/033.jpg', desc:'En una sala de teatro solos' },
    { type:'img',   src:'media/034.jpg', desc:'Foto al solcito en el pasillo' },
    { type:'video', src:'media/034.mp4', desc:'Yendo a acampar al mirador de los cóndores' },
    { type:'img',   src:'media/035.jpg', desc:'Payaseando en un resto' },
    { type:'img',   src:'media/036.jpg', desc:'❤️‍🩹 ❤️‍🩹 ❤️‍🩹' },
    { type:'img',   src:'media/037.jpg', desc:'Mini session en la vereda' },
    { type:'img',   src:'media/038.jpg', desc:'Cara de "cumplí mi sueño no lo puedo creer"' },
    { type:'img',   src:'media/039.jpg', desc:'De paseo por Chile weon' },
    { type:'img',   src:'media/040.jpg', desc:'Haciendo una cumbresita' },
    { type:'video', src:'media/040.mp4', desc:'Bailando hard techno' },
    { type:'img',   src:'media/041.jpg', desc:'En el campo tomando mates' },
    { type:'img',   src:'media/042.jpg', desc:'En el medio de un trekking Cerro Arco' },
    { type:'img',   src:'media/043.jpg', desc:'Fotito con el chorro de la javie' },
    { type:'img',   src:'media/044.jpg', desc:'Paseando en el valle' },
    { type:'img',   src:'media/045.jpg', desc:'Comiendo los mejores pancakes del mundo' },
    { type:'img',   src:'media/046.jpg', desc:'Matecitos en el Salto Colorado' },
    { type:'img',   src:'media/047.jpg', desc:'El sushi más rico que he probado y vos' },
    { type:'img',   src:'media/048.jpg', desc:'Foto al sol en Los Molles' },
    { type:'img',   src:'media/049.jpg', desc:'The last one' },
  ];

  // ========= RENDER: galería =========
  const $gallery = document.getElementById('gallery');
  const frag = document.createDocumentFragment();

  ITEMS.forEach((item, idx) => {
    const fig = document.createElement('figure');
    fig.className = 'tile';
    fig.tabIndex = 0;
    fig.setAttribute('role','button');
    fig.setAttribute('aria-label', item.type === 'video' ? 'Abrir video' : 'Abrir foto');

    if (item.type === 'img'){
      const img = document.createElement('img');
      img.loading = 'lazy';
      img.alt = item.desc || 'Foto';
      img.dataset.src = item.src; // lazy via IO
      img.className = 'ph';
      fig.appendChild(img);
    } else {
      const v = document.createElement('video');
      v.muted = true; v.playsInline = true; v.preload = 'metadata';
      if (item.poster) v.poster = item.poster;
      v.dataset.src = item.src; // lazy set later
      v.className = 'ph';
      fig.appendChild(v);
    }

    const cap = document.createElement('figcaption');
    cap.className = 'cap';
    cap.innerHTML = `<div class="meta">${idx+1} / ${ITEMS.length}</div>
                    <div class="text">${item.desc || ''}</div>`;
    fig.appendChild(cap);

    fig.addEventListener('click', (e)=>{ cuteBurst(e.clientX, e.clientY, 10); openLightbox(idx); });
    fig.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); openLightbox(idx);} });

    frag.appendChild(fig);
  });

  $gallery.appendChild(frag);

  // ========= Lazy loading con IntersectionObserver =========
  const io = new IntersectionObserver((entries)=>{
    entries.forEach(e=>{
      if (e.isIntersecting){
        const el = e.target;
        const src = el.dataset.src;
        if (src){
          if (el.tagName === 'IMG') el.src = src;
          else if (el.tagName === 'VIDEO') el.src = src + '#t=0.1'; // apuntar a 0.1s para forzar thumbnail en algunos navegadores
          el.classList.remove('ph');
          io.unobserve(el);
        }
      }
    });
  }, { rootMargin:'200px 0px' });

  document.querySelectorAll('.tile img, .tile video').forEach(el=> io.observe(el));

  // ========= Lightbox =========
  const $overlay = document.getElementById('lightbox');
  const $viewer  = document.getElementById('viewer');
  const $lbText  = document.getElementById('lbText');
  const $lbMeta  = document.getElementById('lbMeta');
  const $btnClose= document.getElementById('btnClose');
  const $btnPrev = document.getElementById('btnPrev');
  const $btnNext = document.getElementById('btnNext');
  let current = 0;

  function openLightbox(idx){
    current = idx;
    renderLightbox();
    $overlay.classList.add('active');
    document.body.style.overflow = 'hidden';
  }
  function closeLightbox(){
    $overlay.classList.remove('active');
    $viewer.innerHTML = '';
    document.body.style.overflow = '';
  }
  function nav(delta){
    current = (current + delta + ITEMS.length) % ITEMS.length;
    renderLightbox();
  }
  function renderLightbox(){
    const it = ITEMS[current];
    $viewer.innerHTML = '';
    let node;
    if (it.type === 'img'){
      node = document.createElement('img');
      node.src = it.src;
      node.alt = it.desc || 'Foto';
    } else {
      node = document.createElement('video');
      node.controls = true; node.playsInline = true; node.autoplay = true;
      node.src = it.src;
      if (it.poster) node.poster = it.poster;
    }
    $viewer.appendChild(node);
    // animación de entrada
    node.style.animation = 'popIn 360ms cubic-bezier(.2,.9,.2,1.2)';
    $lbText.textContent = it.desc || '';
    $lbMeta.textContent = `${current+1} / ${ITEMS.length} · ${it.type === 'video' ? 'Video' : 'Foto'}`;
  }

  $btnClose.addEventListener('click', closeLightbox);
  $btnPrev.addEventListener('click', ()=>nav(-1));
  $btnNext.addEventListener('click', ()=>nav(1));
  $overlay.addEventListener('click', (e)=>{ if(e.target.classList.contains('backdrop')) closeLightbox(); });
  window.addEventListener('keydown', (e)=>{
    if (!$overlay.classList.contains('active')) return;
    if (e.key === 'Escape') closeLightbox();
    if (e.key === 'ArrowLeft') nav(-1);
    if (e.key === 'ArrowRight') nav(1);
  });

  // Efecto tierno de emojis al abrir
  function cuteBurst(x, y, n = 10){
    const emojis = ['✨','💜','💖','⭐','🌟'];
    for (let i=0;i<n;i++){
      const s = document.createElement('div'); s.className = 'emoji-pop';
      s.textContent = emojis[Math.floor(Math.random()*emojis.length)];
      const dx = (Math.random()*120 - 60) + 'px';
      const dy = (Math.random()*-140 - 40) + 'px';
      const rot = (Math.random()*60 - 30) + 'deg';
      s.style.left = x + 'px'; s.style.top = y + 'px';
      s.style.setProperty('--dx', dx);
      s.style.setProperty('--dy', dy);
      s.style.setProperty('--rot', rot);
      document.body.appendChild(s);
      setTimeout(()=> s.remove(), 1000);
    }
  }

  // ========= Candado =========
  const inputs = Array.from(document.querySelectorAll('.digits input'));
  const $msg   = document.getElementById('msg');
  const $check = document.getElementById('check');
  const $reset = document.getElementById('reset');
  const $final = document.getElementById('final');
  const $lock  = document.getElementById('lock');

  inputs.forEach((inp, idx)=>{
    inp.addEventListener('input', e=>{
      e.target.value = e.target.value.replace(/\D/g,'').slice(0,1);
      if (e.target.value && idx < inputs.length-1) inputs[idx+1].focus();
    });
    inp.addEventListener('keydown', e=>{
      if (e.key === 'Backspace' && !inp.value && idx>0) inputs[idx-1].focus();
    });
  });

  const codeValue = () => inputs.map(i=>i.value||'').join('');
  const showMsg = (txt, cls) => { $msg.textContent = txt; $msg.className = 'msg ' + (cls||''); };

  $check.addEventListener('click', tryUnlock);
  inputs[inputs.length-1].addEventListener('input', ()=>{ if (codeValue().length===4) tryUnlock(); });
  $reset.addEventListener('click', ()=>{ inputs.forEach(i=>i.value=''); inputs[0].focus(); showMsg('', ''); });

  function tryUnlock(){
    const v = codeValue();
    if (v.length<4) return showMsg('Ingresá los 4 dígitos', 'err');
    if (v === CODE){
      showMsg('¡Correcto! Abriendo…','ok');
      celebrate(22);
      $lock.style.display = 'none';
      $final.style.display = 'block';
      setTimeout(()=> document.getElementById('finalVid')?.scrollIntoView({behavior:'smooth'}), 300);
    } else {
      showMsg('Mmm… no. Pista: cuatro iguales 😉', 'err');
      shake($lock);
    }
  }

  function shake(el){
    el.animate([
      {transform:'translateX(0)'}, {transform:'translateX(-6px)'}, {transform:'translateX(6px)'}, {transform:'translateX(0)'}
    ], {duration:260, iterations:1});
  }

  function celebrate(n=22){
    for (let i=0;i<n;i++){
      const s = document.createElement('div'); s.className='confetti';
      s.style.left = Math.random()*100 + 'vw';
      s.style.background = `hsl(${Math.floor(Math.random()*360)} 90% 60%)`;
      s.style.animation = `fall ${3+Math.random()*2}s linear forwards`;
      s.style.transform = `rotate(${Math.random()*360}deg)`;
      document.body.appendChild(s);
      setTimeout(()=>s.remove(), 5500);
    }
  }
</script>
</body>
</html>
